(()=>{"use strict";function e(e,t){function o(t){return e.querySelector(`option[value="${t}"]`).removeAttribute("disabled")}switch(e.querySelectorAll("option").forEach((e=>{e.setAttribute("disabled","disabled")})),t.value){case"1":o("1"),e.value="1";break;case"2":o("1"),o("2"),e.value="2";break;case"3":o("1"),o("2"),o("3"),e.value="3";break;case"100":o("0"),e.value="0"}}const t=document.querySelector(".ad-form"),o=document.querySelector(".map__filters");function n(e){const t=e.classList[0];e.classList.remove(`${t}--disabled`),e.querySelectorAll("fieldset").forEach((e=>{e.removeAttribute("disabled")})),e.querySelectorAll("select").forEach((e=>{e.removeAttribute("disabled")}))}function r(e,t){const o=Math.ceil(Math.min(Math.abs(e),Math.abs(t))),n=Math.floor(Math.max(Math.abs(e),Math.abs(t))),r=Math.random()*(n-o+1)+o;return Math.floor(r)}function a(e,t,o=1){const n=Math.min(Math.abs(e),Math.abs(t)),r=Math.max(Math.abs(e),Math.abs(t));return(Math.random()*(r-n)+n).toFixed(o)}function c(e){return e[r(0,e.length-1)]}function s(e){const t=e.length-1;return e.slice(r(0,t))}const i=["palace","flat","house","bungalow","hotel"],u=["12:00","13:00","14:00"],l=["wifi","dishwasher","parking","washer","elevator","conditioner"],p=["https://assets.htmlacademy.ru/content/intensive/javascript-1/keksobooking/duonguyen-8LrGtIxxa4w.jpg","https://assets.htmlacademy.ru/content/intensive/javascript-1/keksobooking/brandon-hoogenboom-SNxQGWxZQi0.jpg","https://assets.htmlacademy.ru/content/intensive/javascript-1/keksobooking/claire-rendall-b6kAwr1i0Iw.jpg"];function d(){return Array.from({length:5},(()=>function(){const e={x:a(35.65,35.7,5),y:a(139.7,139.8,5)};return{AUTHOR:{avatar:`img/avatars/user0${r(1,8)}.png`},OFFER:{title:"строка — заголовок",address:{location:e},price:r(1e3,1e6),type:c(i),rooms:r(1,8),guests:r(1,8),checkin:c(u),checkout:c(u),features:s(l),description:"строка — описание",photos:s(p)}}}()))}function h(e,t){return e>=5?t[2]:1===e?t[0]:t[1]}function m(e,t){return"rooms"===e?h(t,["комната","комнаты","комнат"]):"guests"===e?h(t,["гостя","гостей","гостей"]):void 0}const f=L.map("map-canvas").on("load",(()=>{n(t),n(o)})).setView({lat:35.6817,lng:139.753891},16);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(f);const b=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),v=L.marker({lat:35.6817,lng:139.753891},{draggable:!0,icon:b});v.addTo(f);const y=document.querySelector("#address");function g(e,t){const o=L.icon({iconUrl:"img/main-pin.svg",iconSize:[40,40],iconAnchor:[20,40]});L.marker({lat:e.OFFER.address.location.x,lng:e.OFFER.address.location.y},{icon:o}).addTo(f).bindPopup(function(e){return function(e){const t=e.OFFER,o=e.AUTHOR,n=document.querySelector("#card").content.querySelector(".popup").cloneNode(!0);return function(e,t){const o=t.querySelector(".popup__title");e.title?o.textContent=e.title:o.remove()}(t,n),function(e,t){const o=t.querySelector(".popup__text--address");e.address.location.x&&e.address.location.y?o.textContent=`${e.address.location.x}, ${e.address.location.y}`:o.remove()}(t,n),function(e,t){const o=t.querySelector(".popup__text--price");e.price?o.textContent=`${e.price} ₽/ночь`:o.remove()}(t,n),function(e,t){const o=t.querySelector(".popup__type");e.type?o.textContent=function(e){switch(e){case"flat":return"Квартира";case"bungalow":return"Бунгало";case"house":return"Дом";case"palace":return"Дворец";case"hotel":return"Отель"}}(e.type):o.remove()}(t,n),function(e,t){const o=t.querySelector(".popup__text--capacity");e.rooms&&e.guests||o.remove(),o.textContent=`${e.rooms} ${m("rooms",e.rooms)} для ${e.guests} ${m("guests",e.guests)}`}(t,n),function(e,t){const o=t.querySelector(".popup__text--time");e.checkin&&e.checkout?o.textContent=`Заезд после ${e.checkin}, выезд до ${e.checkout}`:o.remove()}(t,n),function(e,t){const o=t.querySelectorAll(".popup__feature"),n=t.querySelectorAll(".popup__features");if(!e.features)return void n.remove();const r=e.features.map((e=>`popup__feature--${e}`));o.forEach((e=>{const t=e.classList[1];r.includes(t)||e.remove()}))}(t,n),function(e,t){const o=t.querySelector(".popup__description");e.description?o.textContent=e.description:o.remove()}(t,n),function(e,t){const o=t.querySelector(".popup__photos"),n=o.querySelector(".popup__photo"),r=[];if(e.photos){for(let t=0;t<e.photos.length;t++)r.push(n.cloneNode(!0));n.remove(),r.forEach(((t,n)=>{t.setAttribute("src",e.photos[n]),o.appendChild(t)}))}else o.remove()}(t,n),function(e,t){const o=t.querySelector(".popup__avatar");e.avatar?o.setAttribute("src",e.avatar):o.remove()}(o,n),n}(d()[e])}(t),{keepInView:!0})}document.addEventListener("DOMContentLoaded",(()=>{y.value=v.getLatLng()})),v.on("moveend",(e=>{y.value=e.target.getLatLng()})),d().forEach(((e,t)=>{g(e,t)})),function(){const t=document.querySelector("#type"),o=document.querySelector("#price"),n=document.querySelector("#timein"),r=document.querySelector("#timeout"),a=document.querySelector("#room_number"),c=document.querySelector("#capacity");document.addEventListener("DOMContentLoaded",e(c,a)),t.addEventListener("change",(()=>function(e,t){switch(t.value){case"bungalow":e.setAttribute("min","0"),e.setAttribute("placeholder","0");break;case"flat":e.setAttribute("min","1000"),e.setAttribute("placeholder","1 000");break;case"hotel":e.setAttribute("min","3000"),e.setAttribute("placeholder","3 000");break;case"house":e.setAttribute("min","5000"),e.setAttribute("placeholder","5 000");break;case"palace":e.setAttribute("min","10000"),e.setAttribute("placeholder","10 000")}}(o,t))),o.addEventListener("input",(()=>function(e){e.reportValidity()}(o))),n.addEventListener("change",(()=>function(e,t){t.value=e.value}(n,r))),a.addEventListener("change",(()=>e(c,a)))}()})();